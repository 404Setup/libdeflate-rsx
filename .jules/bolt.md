## 2024-05-23 - Optimization of `write_sequences_to_bitstream` vs `decompress_offset_alignr_cycle`

**Learning:** Attempting to optimize `decompress_offset_alignr_cycle` for Shift 5 (Offset 27) and Shift 3 (Offset 29) by manually breaking the dependency chain using `alignr` resulted in incorrect data. The logic derived from `Shift 13` (Offset 19) did not generalize as expected, or my understanding of `alignr` semantics with specific shift values was flawed. The complexity of SIMD dependency chains makes manual unrolling error-prone without thorough understanding of the specific data flow.

**Action:** When specialized SIMD logic is fragile or hard to verify, focus on optimizing the "common denominator" hot paths. I pivoted to optimizing `write_sequences_to_bitstream` in the compressor. By manually inlining bitstream writes and caching state in local variables (registerizing `bitbuf`, `bitcount`, `out_idx`), I achieved a robust performance improvement that benefits all compression levels and data patterns, avoiding the risk of subtle data corruption in specialized decompression paths.
